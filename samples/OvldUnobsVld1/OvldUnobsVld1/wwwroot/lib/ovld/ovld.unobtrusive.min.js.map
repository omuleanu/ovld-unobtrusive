{"version":3,"file":"ovld.unobtrusive.min.js","sources":["../src/ovld.unobtrusive.js"],"sourcesContent":["(function (vld) {\r\n    let defaults = { autorun: 1 };\r\n    const { find, attr } = vld.core;\r\n    const attachedFlag = 'ovldunobs';\r\n\r\n    init();\r\n\r\n    function data(elm, name, val) {\r\n        if (val === undefined) {            \r\n            return elm.dataset[name];\r\n        }\r\n        else if (val === null) {\r\n            delete elm.dataset[name];\r\n        }\r\n        else {\r\n            elm.dataset[name] = val;\r\n        }\r\n    }\r\n\r\n    function bind({ selector, rules, related, elements, subev, msgCont } = { selector: 'form', subev: 'submit' }) {\r\n        let destrFuncs = [];\r\n\r\n        msgCont = msgCont || function ({ input, name }) {\r\n            const nodes = find(input.closest(selector), `[data-valmsg-for=\"${name}\"]`);\r\n\r\n            if (!nodes.length) return;\r\n\r\n            return nodes[0];\r\n        };\r\n\r\n        (elements || find(document, selector)).forEach(function (cont) {            \r\n            if (data(cont, attachedFlag)) {                \r\n                return;\r\n            }\r\n\r\n            data(cont, attachedFlag, 1);\r\n\r\n            const api = vld.bind({\r\n                subev,\r\n                cont,\r\n                getRules: () => {\r\n                    return mergeRules(parseRules(cont), rules);\r\n                },\r\n                msgCont,\r\n                related\r\n            });\r\n\r\n            destrFuncs.push(() => {\r\n                api.destroy();\r\n                data(cont, attachedFlag, null);\r\n            });\r\n        });\r\n\r\n        return {\r\n            destroy: () => {\r\n                destrFuncs.forEach(f => f());\r\n            }\r\n        };\r\n    }\r\n\r\n    function mergeRules(main, rules) {\r\n        if (rules) {\r\n            for (const key in rules) {\r\n                if (main[key] != null) {\r\n                    main[key] = [...main[key], ...rules[key]];\r\n                } else {\r\n                    main[key] = rules[key];\r\n                }\r\n            }\r\n        }\r\n\r\n        return main;\r\n    }\r\n\r\n    function parseRules(form) {\r\n        const rules = {};\r\n\r\n        function addRule(key, rule) {\r\n            if (!rules[key]) rules[key] = [];\r\n            rules[key].push(rule);\r\n        }\r\n\r\n        var dval = 'data-val-';\r\n        var dmaxlen = `${dval}maxlength`;\r\n        var dminlen = `${dval}minlength`;\r\n        var dmaxlenmax = dmaxlen + '-max';\r\n        var dminlenmin = dminlen + '-min';\r\n\r\n        find(form, `[${dmaxlenmax}]`).forEach(function (inp) {\r\n            var max = attr(inp, dmaxlenmax);\r\n            addRule(attr(inp, 'name'), { chk: vld.rules.maxlen(max), msg: attr(inp, dmaxlen) });\r\n        });\r\n\r\n        find(form, `[${dminlenmin}]`).forEach(function (inp) {\r\n            var min = attr(inp, dminlenmin);\r\n            addRule(attr(inp, 'name'), { chk: vld.rules.minlen(min), msg: attr(inp, dminlen) });\r\n        });\r\n\r\n        find(form, `[${dval}length]`).forEach(function (inp) {\r\n            var min = attr(inp, `${dval}length-min`);\r\n            var max = attr(inp, `${dval}length-max`);\r\n            addRule(\r\n                attr(inp, 'name'),\r\n                {\r\n                    chk: vld.rules.len({ min, max }),\r\n                    msg: attr(inp, `${dval}length`)\r\n                });\r\n        });\r\n\r\n        find(form, `[${dval}required]`).forEach(function (inp) {\r\n            var name = attr(inp, 'name');\r\n            addRule(name, { chk: vld.rules.req, msg: attr(inp, `${dval}required`) });\r\n        });\r\n\r\n        return rules;\r\n    }\r\n\r\n    function validate({ cont, rules }) {\r\n        return vld.validate({ cont, rules: mergeRules(parseRules(cont), rules) });\r\n    }\r\n\r\n    function setDefaults(opt) {\r\n        defaults = Object.assign({}, defaults, opt);\r\n    }\r\n\r\n    function init() {\r\n        // doc ready\r\n        document.addEventListener('DOMContentLoaded', function () {\r\n            if (defaults.autorun) {\r\n                bind();\r\n            }\r\n        });\r\n        \r\n        const $ = window.jQuery;\r\n        if ($) {\r\n            $(document).on('ovlduCallBind', () => bind());\r\n        }\r\n        else {\r\n            document.addEventListener('ovlduCallBind', () => bind());\r\n        }    \r\n\r\n        document.dispatchEvent(new CustomEvent('ovlduInit', { cancelable: true, bubbles: true, isTrusted: true }));\r\n    }    \r\n\r\n    vld.unobtrusive = {\r\n        bind,\r\n        setDefaults,\r\n        validate\r\n    };\r\n}(window.ovld));"],"names":["vld","defaults","autorun","find","attr","core","attachedFlag","data","elm","name","val","dataset","bind","selector","rules","related","elements","subev","msgCont","destrFuncs","input","nodes","closest","length","document","forEach","cont","api","getRules","mergeRules","parseRules","push","destroy","f","main","key","form","addRule","rule","dval","dmaxlen","dminlen","dmaxlenmax","dminlenmin","inp","max","chk","maxlen","msg","min","minlen","len","req","addEventListener","$","window","jQuery","on","dispatchEvent","CustomEvent","cancelable","bubbles","isTrusted","unobtrusive","setDefaults","opt","Object","assign","validate","ovld"],"mappings":"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"}